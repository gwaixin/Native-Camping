{"version":3,"sources":["lesson.coffee"],"names":[],"mappings":"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","file":"lesson.js","sourcesContent":["'use strict'\n\nwindow.ncApp.controller 'Lesson', [\n\t'$scope'\n\t'$http'\n\t($s, $http) ->\n\t\tself = this\n\t\t\n\t\t### initialize variables ###\n\t\t$s.chats = []\n\t\t$s.chatMessage = \"\"\n\t\t\n\t\t### initialize lesson ###\n\t\t$s.init = () ->\n\t\t\tconnect.init (conn) ->\n\t\t\t\t###initialize camera ###\n\t\t\t\tconnect.initializeCamera ->\n\t\t\t\t\t### initialize events ###\n\t\t\t\t\teventCommon.init()\n\t\t\t\t\t### initialize events ###\n\t\t\t\t\teventTeacher.init()\n\t\t\t\t\t### initialize connect to room ###\n\t\t\t\t\teventCommon.connectToRoom()\n\t\t\t\t\t### catch when no camera is detected ###\n\t\t\t\t\treturn\n\t\t\t\t, ->\n\t\t\t\t\tconsole.log 'Cannot detect camera'\n\t\t\t\t\treturn\n\t\t\t, (error, conn) ->\n\t\t\t\tconsole.warn 'ERROR to connect socket:', error, conn\n\t\t\n\t\t###*\n\t\t * disconnecting lesson\n\t\t * @param  {Object} data contains information about the disconnection\n\t\t###\n\t\t$s.lessonDisconnect = (data) ->\n\t\t\tconsole.warn data\n\t\t\t\n\t\t\t### prepare command ###\n\t\t\tcommand = if typeof data.command != 'undefined' then data.command else 'unknown'\n\t\t\t\n\t\t\t### check the disconnection type ###\n\t\t\tswitch command\n\t\t\t\twhen constant.disconnect.student.finished\n\t\t\t\t\t### student ended lesson ###\n\t\t\t\t\tconsole.warn '[SOCKET] student stopped lesson'\n\t\t\t\t\twindow.location.href = '/student?action=' +command\n\t\t\t\t\tbreak\n\t\t\t\t\n\t\t\t\twhen constant.disconnect.student.sudden\n\t\t\t\t\t### student sudden disconnect ###\n\t\t\t\t\tconsole.warn '[SOCKET] student sudden disconnect'\n\t\t\t\t\tbreak\n\t\t\t\t\n\t\t\t\twhen constant.disconnect.student.timeOut \n\t\t\t\t\t### student's connection to the socket server timed out ###\n\t\t\t\t\tconsole.log 'Because the student was unable to reconnect within the alotted time, the system will automatically end the lesson.'\n\t\t\t\t\t\n\t\t\t\t\t### redirect the teacher to dashboard ###\n\t\t\t\t\tsetTimeout(() ->\n\t\t\t\t\t\twindow.location.href = '/teacher?action=' + command\n\t\t\t\t\t\treturn\n\t\t\t\t\t, 2000)\n\t\t\t\t\tbreak\n\t\t\t\telse \n\t\t\t\t\t### command does not belongs to any case ###\n\t\t\t\t\tconsole.log 'Unknown disconnection command -> ', command\n\t\t\t\t\tbreak\n\t\t\treturn\n\t\t\n\t\t###*\n\t\t * redirect to others page, however it will stop the lesson if it has lesson\n\t\t###\n\t\t$s.toOthers = () ->\n\t\t\tconsole.warn '[NG] go to others'\n\t\t\treason = prompt \"Are you sure to go to others? state your reason why.\", \"reason here\"\n\n\t\t\tif reason\n\t\t\t\tdata = {\n\t\t\t\t\tcommand: 'teacherLessonDisconnectOthers',\n\t\t\t\t\tcontent: connect.config,\n\t\t\t\t\tmode: 'to'\n\t\t\t\t}\n\t\t\t\teventCommon.sendCommand data\n\t\t\t\twindow.location.href = \"/teacher?action=other\"\n\t\t\telse\n\t\t\t\treturn\n\n\t\t###*\n\t\t * sending message to student by sending it to socket\n\t\t###\n\t\t$s.sendMessage = (message, sender) ->\n\t\t\tconsole.log '[NG] sending message init'\n\t\t\t\n\t\t\t### validate send message ###\n\t\t\tif message == \"\" or typeof message == \"undefined\"\n\t\t\t\tconsole.warn '[NG] message is empty'\n\t\t\t\treturn\n\t\t\t\n\t\t\tconsole.log '[NG] continue message send'\n\t\t\t\n\t\t\t### prepare message data ###\n\t\t\tdata = {\n\t\t\t\tcommand: 'sendChat'\n\t\t\t\tcontent: connect.config\n\t\t\t\tmode: 'to'\n\t\t\t\tmessage: message\n\t\t\t}\n\t\t\t\n\t\t\t### check if there was a sender, otherwise the teacher is the sender ###\n\t\t\tif typeof sender == 'undefined'\n\t\t\t\tsender = \"me\"\n\t\t\t\t### send chat to student via socket ###\n\t\t\t\teventCommon.sendCommand data\n\t\t\telse if sender == 'system'\n\t\t\t\t### just do nothing ###\n\t\t\telse\n\t\t\t\tsender = connect.config.teacherID\n\t\t\t\t\n\t\t\t### inser new message to chat layout ###\n\t\t\t$s.chats.push {\n\t\t\t\tsender: sender\n\t\t\t\tmessage: message\n\t\t\t}\n\t\t\t\n\t\t\t### clear message chat input ###\n\t\t\t$s.chatMessage = \"\"\n\t\t\treturn\n\t\t\n\t\treturn\n\t\t\t\t\n]\n.directive 'ngEnter', () ->\n\t(scope, element, attrs) ->\n\t\telement.bind 'keydown keypress', (event) ->\n\t\t\tif event.which == 13\n\t\t\t\tscope.$apply ()->\n\t\t\t\t\tscope.$eval attrs.ngEnter\n\t\t\t\t\treturn\n\t\t\t\tevent.preventDefault()\n\t\t\treturn\n\t\treturn"],"sourceRoot":"/source/"}